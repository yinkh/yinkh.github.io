
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="YinKH个人博客">
      
      
        <meta name="author" content="yinkanghong">
      
      
      <link rel="icon" href="../../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Django笔记 - YinKH</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="YinKH" class="md-header__button md-logo" aria-label="YinKH" data-md-component="logo">
      
  <img src="../../../assets/images/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            YinKH
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Django笔记
            
          </span>
        </div>
      </div>
    </div>
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../python/python-note/" class="md-tabs__link md-tabs__link--active">
        Python
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../java/android/todo-sync/" class="md-tabs__link">
        Java
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../front/javascript/javascript-note/" class="md-tabs__link">
        前端
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../auto/github-pages/" class="md-tabs__link">
        自动化
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../cache/redis/zset/" class="md-tabs__link">
        缓存
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../linux/os-note/" class="md-tabs__link">
        Linux
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../tags/" class="md-tabs__link">
        其他
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="夜晚模式"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="夜晚模式" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="白天模式"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="白天模式" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="YinKH" class="md-nav__button md-logo" aria-label="YinKH" data-md-component="logo">
      
  <img src="../../../assets/images/favicon.ico" alt="logo">

    </a>
    YinKH
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1" type="checkbox" id="__nav_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_1">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/python-note/" class="md-nav__link">
        Python笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/python-venv/" class="md-nav__link">
        Virtualenv
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/pycharm/" class="md-nav__link">
        Pycharm调教
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/rw-excel/" class="md-nav__link">
        python读写Excel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/pip-publish/" class="md-nav__link">
        PyPi发布
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/pycharm-ssh/" class="md-nav__link">
        Pycharm中利用ssh远程部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/pinyin/" class="md-nav__link">
        汉字转拼音（简码生成）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/sf-express/" class="md-nav__link">
        顺丰丰桥对接笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/mkdocs/" class="md-nav__link">
        MkDocs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          FastApi
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="FastApi" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          FastApi
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fastapi/tortoise-orm/" class="md-nav__link">
        tortoise-orm教程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fastapi/request-id/" class="md-nav__link">
        request-id实现
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fastapi/fastapi-uvicorn-logrotate/" class="md-nav__link">
        FastApi+Uvicorn使用logrotate压缩access日志后新日志无法正常输出
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fastapi/Flask-Django-FastApi-SpringBoot-Go-performance/" class="md-nav__link">
        Flask、Django、FastApi、SpringBoot、Go性能比较
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          Django
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Django" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Django
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Django笔记
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Django笔记
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    常用命令
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model" class="md-nav__link">
    Model相关
  </a>
  
    <nav class="md-nav" aria-label="Model相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#foreignkey" class="md-nav__link">
    ForeignKey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    是否有值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#related_name" class="md-nav__link">
    设置related_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manytomnay" class="md-nav__link">
    ManyToMnay
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    添加、移除
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    批量添加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#related_name_1" class="md-nav__link">
    设置related_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    反向检索
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m2mself" class="md-nav__link">
    M2M到self时的问题
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    外键到一个不确定的类的对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#durationfield" class="md-nav__link">
    DurationField使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bulk_create" class="md-nav__link">
    bulk_create使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    金额操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    验证相关
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property" class="md-nav__link">
    property
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cached-properties" class="md-nav__link">
    Cached properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unique_togethercharnulltrueblanktrue" class="md-nav__link">
    unique_together其中有Char字段null=True,blank=True
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    检索相关
  </a>
  
    <nav class="md-nav" aria-label="检索相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queryset" class="md-nav__link">
    queryset内操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_object_or_404" class="md-nav__link">
    get_object_or_404
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_or_create" class="md-nav__link">
    get_or_create
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queryset_1" class="md-nav__link">
    求querySet某一字段的和
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    update()方法注意事项
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annotateaggregate" class="md-nav__link">
    annotate和aggregat‌e函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values_list" class="md-nav__link">
    values_list去重
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queryset_2" class="md-nav__link">
    queryset获取外键列表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manager" class="md-nav__link">
    自定义Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search_fields" class="md-nav__link">
    如何在 search_fields 中包含外键字段
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queryset_3" class="md-nav__link">
    queryset间操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queryset_4" class="md-nav__link">
    queryset相减
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queryset_5" class="md-nav__link">
    queryset相加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrations" class="md-nav__link">
    migrations文件冲突
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrate-fake" class="md-nav__link">
    migrate --fake
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    Url相关
  </a>
  
    <nav class="md-nav" aria-label="Url相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    重定向
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    正则
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    View相关
  </a>
  
    <nav class="md-nav" aria-label="View相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#render" class="md-nav__link">
    render函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#success_url" class="md-nav__link">
    动态success_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    基类继承信息时，基类要优先继承，不然不起作用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listviewqueryset" class="md-nav__link">
    ListView中queryset使用陷阱
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#form" class="md-nav__link">
    Form相关
  </a>
  
    <nav class="md-nav" aria-label="Form相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    使用预设的错误
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    动态添加错误
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#template" class="md-nav__link">
    Template相关
  </a>
  
    <nav class="md-nav" aria-label="Template相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#html" class="md-nav__link">
    渲染变量至html
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#templet" class="md-nav__link">
    templet常用过滤器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    检测用户是否有某项权限
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#booleanjs" class="md-nav__link">
    传递boolean至js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listjs" class="md-nav__link">
    传递list至js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    绝对路径生成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django-filter" class="md-nav__link">
    Django-filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tags" class="md-nav__link">
    自定义Tags
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    分页
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#admin" class="md-nav__link">
    Admin相关
  </a>
  
    <nav class="md-nav" aria-label="Admin相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list" class="md-nav__link">
    方法结果显示在list中
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    设置字段只读
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admin_1" class="md-nav__link">
    设置字段不出现在admin中
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#superuser" class="md-nav__link">
    修改SuperUser密码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admintitle" class="md-nav__link">
    设置站点admin显示title
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appverbose_name" class="md-nav__link">
    设置app的verbose_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modelverbose_name" class="md-nav__link">
    设置model的verbose_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    设置列表可编辑字段
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    Utils相关
  </a>
  
    <nav class="md-nav" aria-label="Utils相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    字符拼接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    页面间消息传递
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#str" class="md-nav__link">
    判断str是否为数字
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model_1" class="md-nav__link">
    由数据库表名称获取对应的model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    字符串连续定义
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    Python类型判断
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    信号
  </a>
  
    <nav class="md-nav" aria-label="信号">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_finished" class="md-nav__link">
    request_finished
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    自定义信号
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre_save" class="md-nav__link">
    pre_save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post_save" class="md-nav__link">
    post_save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    信号不触发问题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    测试
  </a>
  
    <nav class="md-nav" aria-label="测试">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    测试驱动开发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    测试函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pycharm" class="md-nav__link">
    Pycharm中运行测试的注意事项
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    设置断点
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    第三方工具及作用简介
  </a>
  
    <nav class="md-nav" aria-label="第三方工具及作用简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-celery" class="md-nav__link">
    django-celery
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    其他
  </a>
  
    <nav class="md-nav" aria-label="其他">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    定义类内部方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    三目运算精简代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestdatadictquerydict" class="md-nav__link">
    request.data类型是Dict不是QueryDict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    原生sql防注入
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-summernote/" class="md-nav__link">
        Django-summernote富文本
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-wysiwyg/" class="md-nav__link">
        Django富文本编辑器(wysiwyg)对比
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-constance/" class="md-nav__link">
        Django-constance实现动态设置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-channels/" class="md-nav__link">
        Django-Channels使用和部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-cors-headers/" class="md-nav__link">
        Django使用django-cors-headers处理API跨域问题
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-oss/" class="md-nav__link">
        在Django中使用OSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-translation/" class="md-nav__link">
        Django多语言支持
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-transaction/" class="md-nav__link">
        Django事务
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sitemap-rss-robots/" class="md-nav__link">
        Django搜索优化sitemap、RSS、robots
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-multiselectfield/" class="md-nav__link">
        Django-multiselectfield实现固定值多选
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../order-id/" class="md-nav__link">
        Django订单编号生成
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-popup/" class="md-nav__link">
        Django弹窗新增、修改、删除ForeignKey、ManyToMany
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-haystack/" class="md-nav__link">
        Django-haystack全局搜索
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-cleanup/" class="md-nav__link">
        Django-cleanup 清理文件
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-orm/" class="md-nav__link">
        Django-orm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-model/" class="md-nav__link">
        Django重写model的增删查改方法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-m2m/" class="md-nav__link">
        Django save方法不立即更新ManyToManyField的问题
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-TinyMCE/" class="md-nav__link">
        Django Admin中集成TinyMCE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../html-email/" class="md-nav__link">
        Django发送Html邮件
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-celery/" class="md-nav__link">
        Django celery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-admin/" class="md-nav__link">
        Django admin对比
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-permissions/" class="md-nav__link">
        Django权限机制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-extensions/" class="md-nav__link">
        Django模型依赖可视化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../django-smtp/" class="md-nav__link">
        阿里云邮箱 smtp/pop3 Android客户端,Django后台设置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nginx-uwsgi/" class="md-nav__link">
        Nginx+uWsgi部署Django
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../apache/" class="md-nav__link">
        Apache部署Django
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fabric/" class="md-nav__link">
        Fabric部署、维护
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          DjangoRestFramework
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DjangoRestFramework" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          DjangoRestFramework
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../drf/drf-note/" class="md-nav__link">
        DjangoRestFramework笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../drf/rest_framework_cache/" class="md-nav__link">
        rest_framework_cache优化接口访问速度
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../drf/drf-writable-nested/" class="md-nav__link">
        drf-writable-nested嵌套新增更新
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Java
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Java
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Andorid
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Andorid" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Andorid
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/todo-sync/" class="md-nav__link">
        Android离线数据同步策略
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/okhttp3/" class="md-nav__link">
        Android OkHttp3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/pda-keyboard/" class="md-nav__link">
        Android PDA键盘逻辑
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/viewpager/" class="md-nav__link">
        Android ViewPager总结
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/language/" class="md-nav__link">
        Android语言热切换方案
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/android-note/" class="md-nav__link">
        Android笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/android-amap/" class="md-nav__link">
        高德地图相关笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/android-toolbar/" class="md-nav__link">
        Android状态栏透明
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/android-activity/" class="md-nav__link">
        Android Activity间传递对象
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/android-mjpg/" class="md-nav__link">
        Android MJPG底层C文件编译笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/android-md/" class="md-nav__link">
        Material Design卡片阴影、Ripple Effect实现
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/android/andorid-dialog-edittext/" class="md-nav__link">
        dialog自动弹出软键盘、光标移至Edittext末尾
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          前端
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="前端" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          前端
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          JavaScript
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="JavaScript" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          JavaScript
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../front/javascript/javascript-note/" class="md-nav__link">
        JavaScript笔记
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          NodeJS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="NodeJS" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          NodeJS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../front/nodejs/nvm/" class="md-nav__link">
        nvm管理nodejs版本
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          自动化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="自动化" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          自动化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          CI/CD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CI/CD" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          CI/CD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../auto/github-pages/" class="md-nav__link">
        Github Pages和Actions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          缓存
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="缓存" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          缓存
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_1">
          Redis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Redis" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Redis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cache/redis/zset/" class="md-nav__link">
        Redis SortedSet(有序集合)使用笔记
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/os-note/" class="md-nav__link">
        操作系统笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/nginx-vs-apache/" class="md-nav__link">
        Nginx Vs Apache
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/wrk/" class="md-nav__link">
        wrk压测工具
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/CentOS-7-install-Python3.8.3/" class="md-nav__link">
        CentOS-7安装Python3.8.3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/ubuntu-install/" class="md-nav__link">
        ubuntu安装配置记录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/supervisor-celery/" class="md-nav__link">
        Supervisor使用笔记及celery生产部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/vm/" class="md-nav__link">
        虚拟机安装问题记录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/git-note/" class="md-nav__link">
        Git笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/raspberrypi/" class="md-nav__link">
        树莓派安装 python3 及 python IDE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/ubuntu/" class="md-nav__link">
        Ubuntu笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/unzip/" class="md-nav__link">
        Unzip
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          其他
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="其他" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          其他
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tags/" class="md-nav__link">
        标签
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../other/icon-generate/" class="md-nav__link">
        文字转图标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../other/FileZilla/" class="md-nav__link">
        FileZilla Server搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../other/school-ms/" class="md-nav__link">
        schoolms中逻辑问题记录
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    常用命令
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model" class="md-nav__link">
    Model相关
  </a>
  
    <nav class="md-nav" aria-label="Model相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#foreignkey" class="md-nav__link">
    ForeignKey
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    是否有值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#related_name" class="md-nav__link">
    设置related_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manytomnay" class="md-nav__link">
    ManyToMnay
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    添加、移除
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    批量添加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#related_name_1" class="md-nav__link">
    设置related_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    反向检索
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m2mself" class="md-nav__link">
    M2M到self时的问题
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    外键到一个不确定的类的对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#durationfield" class="md-nav__link">
    DurationField使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bulk_create" class="md-nav__link">
    bulk_create使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    金额操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    验证相关
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property" class="md-nav__link">
    property
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cached-properties" class="md-nav__link">
    Cached properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unique_togethercharnulltrueblanktrue" class="md-nav__link">
    unique_together其中有Char字段null=True,blank=True
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    检索相关
  </a>
  
    <nav class="md-nav" aria-label="检索相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queryset" class="md-nav__link">
    queryset内操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_object_or_404" class="md-nav__link">
    get_object_or_404
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_or_create" class="md-nav__link">
    get_or_create
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queryset_1" class="md-nav__link">
    求querySet某一字段的和
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    update()方法注意事项
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annotateaggregate" class="md-nav__link">
    annotate和aggregat‌e函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values_list" class="md-nav__link">
    values_list去重
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queryset_2" class="md-nav__link">
    queryset获取外键列表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manager" class="md-nav__link">
    自定义Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search_fields" class="md-nav__link">
    如何在 search_fields 中包含外键字段
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queryset_3" class="md-nav__link">
    queryset间操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queryset_4" class="md-nav__link">
    queryset相减
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queryset_5" class="md-nav__link">
    queryset相加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrations" class="md-nav__link">
    migrations文件冲突
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrate-fake" class="md-nav__link">
    migrate --fake
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    Url相关
  </a>
  
    <nav class="md-nav" aria-label="Url相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    重定向
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    正则
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    View相关
  </a>
  
    <nav class="md-nav" aria-label="View相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#render" class="md-nav__link">
    render函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#success_url" class="md-nav__link">
    动态success_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    基类继承信息时，基类要优先继承，不然不起作用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listviewqueryset" class="md-nav__link">
    ListView中queryset使用陷阱
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#form" class="md-nav__link">
    Form相关
  </a>
  
    <nav class="md-nav" aria-label="Form相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    使用预设的错误
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    动态添加错误
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#template" class="md-nav__link">
    Template相关
  </a>
  
    <nav class="md-nav" aria-label="Template相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#html" class="md-nav__link">
    渲染变量至html
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#templet" class="md-nav__link">
    templet常用过滤器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    检测用户是否有某项权限
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#booleanjs" class="md-nav__link">
    传递boolean至js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listjs" class="md-nav__link">
    传递list至js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    绝对路径生成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django-filter" class="md-nav__link">
    Django-filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tags" class="md-nav__link">
    自定义Tags
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    分页
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#admin" class="md-nav__link">
    Admin相关
  </a>
  
    <nav class="md-nav" aria-label="Admin相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list" class="md-nav__link">
    方法结果显示在list中
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    设置字段只读
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admin_1" class="md-nav__link">
    设置字段不出现在admin中
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#superuser" class="md-nav__link">
    修改SuperUser密码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admintitle" class="md-nav__link">
    设置站点admin显示title
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appverbose_name" class="md-nav__link">
    设置app的verbose_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modelverbose_name" class="md-nav__link">
    设置model的verbose_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    设置列表可编辑字段
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    Utils相关
  </a>
  
    <nav class="md-nav" aria-label="Utils相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    字符拼接
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    页面间消息传递
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#str" class="md-nav__link">
    判断str是否为数字
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model_1" class="md-nav__link">
    由数据库表名称获取对应的model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    字符串连续定义
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    Python类型判断
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    信号
  </a>
  
    <nav class="md-nav" aria-label="信号">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_finished" class="md-nav__link">
    request_finished
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    自定义信号
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre_save" class="md-nav__link">
    pre_save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post_save" class="md-nav__link">
    post_save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    信号不触发问题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    测试
  </a>
  
    <nav class="md-nav" aria-label="测试">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    测试驱动开发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    测试函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pycharm" class="md-nav__link">
    Pycharm中运行测试的注意事项
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    设置断点
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    第三方工具及作用简介
  </a>
  
    <nav class="md-nav" aria-label="第三方工具及作用简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-celery" class="md-nav__link">
    django-celery
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    其他
  </a>
  
    <nav class="md-nav" aria-label="其他">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    定义类内部方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    三目运算精简代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestdatadictquerydict" class="md-nav__link">
    request.data类型是Dict不是QueryDict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    原生sql防注入
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  



  <h1>Django笔记</h1>

<h2 id="_1">常用命令</h2>
<ul>
<li>django-admin.py startproject projectname  创建项目</li>
<li>django-admin.py startapp appname 创建应用</li>
<li>python manage.py migrations 将models变化迁移至migrations</li>
<li>python manage.py migrate 将migrations变化迁移至数据库</li>
<li>python manage.py collectstatic 拷贝所有类库及app下的static文件夹至STATIC_ROOT文件夹</li>
<li>python manage.py createsuperuser 创建超级管理员</li>
<li>python manage.py runserver 192.168.1.101:80 在对应的IP地址和端口号上运行测试服务器</li>
<li>pip install django -i https://pypi.douban.com/simple  pip更换源</li>
<li>pip install django --upgrade 升级至最新版本</li>
<li>pip install django --upgrade -i https://pypi.douban.com/simple  pip 使用豆瓣源更新至最新版本</li>
<li>pip install -r requirements.txt #批量安装 可用 -i 指定源</li>
<li>pip freeze &gt; requirements.txt 自动生成requirements.txt文件</li>
</ul>
<p>打印详细的错误原因至控制台</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">traceback</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span> <span class="nn">ast</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="c1"># convert [1,2,3] to list directly 直接将字符串[1,2,3]转化为list</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">members</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;members&#39;</span><span class="p">])</span>
</code></pre></div>
<h2 id="model">Model相关</h2>
<h3 id="foreignkey"><code>ForeignKey</code></h3>
<ul>
<li>
<h3 id="_2">是否有值</h3>
</li>
</ul>
<p>外键是否有值</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">ForeignKey__isnull</span><span class="o">=</span><span class="kc">True</span><span class="o">/</span><span class="kc">False</span>
</code></pre></div>
<ul>
<li>
<h3 id="related_name">设置related_name</h3>
</li>
</ul>
<p>在不设置的时候默认名称是</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">modelname_set</span>
</code></pre></div>
<h3 id="manytomnay"><code>ManyToMnay</code></h3>
<p>模型：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># 班级</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="c1"># 名称</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>                            <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>                            <span class="n">verbose_name</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;名称&#39;</span><span class="p">)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="c1"># 学员</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="n">students</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s1">&#39;education.Student&#39;</span><span class="p">,</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>                                      <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>                                      <span class="n">verbose_name</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;学员&#39;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>
<h3 id="_3">添加、移除</h3>
</li>
</ul>
<p>类型对应的操作为</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>add/remove
</code></pre></div>
<ul>
<li>
<h3 id="_4">批量添加</h3>
</li>
</ul>
<p><code>add</code>一次添加一个<code>queryset</code>时，用法为<code>manytomany.add(*queryset)</code>或者<code>manytomany.set(queryset)</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">courses</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;courses&#39;</span><span class="p">))</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">interview</span><span class="o">.</span><span class="n">pre_student</span><span class="o">.</span><span class="n">courses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">courses</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>
<h3 id="related_name_1">设置<code>related_name</code></h3>
</li>
</ul>
<p>在不设置的时候默认名称是</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">modelname_set</span>
</code></pre></div>
<ul>
<li>
<h3 id="_5">反向检索</h3>
</li>
</ul>
<p>学员获取自己参加的所有课程：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">courses</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">prestudent</span><span class="o">.</span><span class="n">student</span><span class="o">.</span><span class="n">myclass_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> 
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="c1"># 以myclass_set为关键字进行反向检索 myclass为类名后面接_set</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">courses</span><span class="p">)</span> <span class="c1"># , , ]&gt;</span>
</code></pre></div>
<ul>
<li>
<h3 id="m2mself">M2M到<code>self</code>时的问题</h3>
</li>
</ul>
<p><code>示例</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># 部门</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="k">class</span> <span class="nc">Department</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="c1"># 部门名称</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>                            <span class="n">verbose_name</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;名称&#39;</span><span class="p">)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="c1"># 子部门 写成&#39;self&#39;时会出现添加部门1的子部门为部门2时</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="c1"># 部门2的子部门里也会有部门1的bug</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    <span class="n">departments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s1">&#39;school.Department&#39;</span><span class="p">,</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>                                         <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>                                         <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;子部门&#39;</span><span class="p">)</span>
</code></pre></div>
<p>此处子部门 M2M的关联写成<code>'self'</code>时会出现添加部门1的子部门为部门2时，部门2的子部门里也会有部门1的bug。 其实这不是bug,解决方法为 （1）将<code>'self'</code>换成<code>'department.Department'</code> (2) 在<code>departments</code>字段中加入<code>'symmetrical=False'</code>，详细介绍见<a href="https://docs.djangoproject.com/en/2.0/ref/models/fields/#django.db.models.ManyToManyField.symmetrical">ManyToManyField.symmetrical</a>。</p>
<blockquote>
<p>Only used in the definition of ManyToManyFields on self. Consider the following model:</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    <span class="n">friends</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>When Django processes this model, it identifies that it has a ManyToManyField on itself, and as a result, it doesn’t add a person_set attribute to the Person class. Instead, the ManyToManyField is assumed to be symmetrical – that is, if I am your friend, then you are my friend.</p>
<p>If you do not want symmetry in many-to-many relationships with self, set symmetrical to False. This will force Django to add the descriptor for the reverse relationship, allowing ManyToManyField relationships to be non-symmetrical.</p>
</blockquote>
<h3 id="_6">外键到一个不确定的类的对象</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">apps</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericForeignKey</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="k">class</span> <span class="nc">UnSureModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="c1"># 类的content_type</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>                                     <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>                                     <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>                                     <span class="n">verbose_name</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;数据来源&#39;</span><span class="p">)</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    <span class="c1"># 对应类型实例ID</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>                                            <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>                                            <span class="n">verbose_name</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;实例ID&#39;</span><span class="p">)</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>    <span class="c1"># 对应的实例</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;object_id&#39;</span><span class="p">)</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>    <span class="k">def</span> <span class="nf">get_select_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_id</span><span class="p">:</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>            <span class="n">select_model</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">app_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>                                          <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>                <span class="n">select_object</span> <span class="o">=</span> <span class="n">select_model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object_id</span><span class="p">)</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>                <span class="k">return</span> <span class="n">select_object</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>                <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>            <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<h3 id="durationfield"><code>DurationField</code>使用</h3>
<p>新增时传入<code>timedelta</code>对象：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">craft</span> <span class="o">=</span> <span class="n">Craft</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;测试&#39;</span><span class="p">,</span> <span class="n">craft_duration</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div>
<p>DRF在新增该字段时是以秒为单位。</p>
<h3 id="bulk_create"><code>bulk_create</code>使用</h3>
<p><code>PostMan</code>发送数据：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">choices</span><span class="err">：</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span><span class="s1">&#39;sss&#39;</span><span class="p">,</span> <span class="s1">&#39;is_right&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span> <span class="n">choices</span><span class="err">：</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span><span class="s1">&#39;sssssss&#39;</span><span class="p">,</span> <span class="s1">&#39;is_right&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
</code></pre></div>
<p>代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">choices</span> <span class="o">=</span> <span class="n">dict_to_query_dict</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;choices&#39;</span><span class="p">)</span> <span class="c1"># 获取choices的list</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1"># list中str转换为dict,dict再转换为Choice类实例，所有的类实例合并为list</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1"># bulk_create入参该list,其内部封装好事务,若其中一个生产错误，则会自动撤销之前操作</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">choice_list</span> <span class="o">=</span> <span class="n">Choice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">bulk_create</span><span class="p">([</span><span class="n">Choice</span><span class="p">(</span><span class="o">**</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">choice</span><span class="p">))</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">])</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c1"># PS：bulk_create不会调用实例的save方法,不会发出post_save信号,返回实例无ID,需要再次手动调用save()</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">choice_list</span><span class="p">:</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">choice</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="n">instance</span> <span class="o">=</span> <span class="n">question_serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="n">instance</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">choice_list</span><span class="p">)</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="n">chapter</span><span class="o">.</span><span class="n">questions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</code></pre></div>
<p>上述<code>PostMan</code>发送的第二条数据<code>is_right</code>类型错误，无法保存，提示错误：ValidationError: ['’2‘ 必须为 True 或者 False。']，bulk_create方法内部封装好事务，则第一条正确的记录也不会被新增。</p>
<h3 id="_7">金额操作</h3>
<p>对金额进行操作时，一律使用<code>DecimalField</code>而不使用<code>FloatFiled</code>。 需要注意的是，<code>DecimalField</code>在模型中设置默认值时，应是：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="mf">0.00</span><span class="p">),</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>                            <span class="n">max_digits</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>                            <span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>                            <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;售价&#39;</span><span class="p">)</span>
</code></pre></div>
<p>而不是</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.00</span><span class="p">,</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>                            <span class="n">max_digits</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>                            <span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>                            <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;售价&#39;</span><span class="p">)</span>
</code></pre></div>
<p>虽然不支持<code>Decimal</code>类型与<code>float</code>类型进行混合操作，则全部转换为<code>Decimal</code>类型再进行四则运算。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">discounted_price</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discount_event</span><span class="o">.</span><span class="n">calculate_discount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real_price</span><span class="p">))</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="bp">self</span><span class="o">.</span><span class="n">discounted_event_price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_price</span> <span class="o">-</span> <span class="n">discounted_price</span>
</code></pre></div>
<p>float类型的str转为int，需要先转化为float再转化为int，不可直接转换:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">class_hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;class_hours&#39;</span><span class="p">]))</span>
</code></pre></div>
<p>不然会将DecimalField的默认值设置为一个float,在计算时会带来类似<code>TypeError: unsupported operand type(s) for *: 'float' and 'decimal.Decimal'</code>这样的错误。</p>
<h3 id="_8">验证相关</h3>
<ul>
<li>限制图片大小</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">def</span> <span class="nf">validate_image_size</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="sd">    限制图片文件大小为2M 2M=2*1024KB=2*1024*1024Byte (Byte既字节)</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="sd">    :param value:文件实例</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="sd">    :return: raise 文件大小超过2MB</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">2097152</span><span class="p">:</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;文件大小超过2MB&#39;</span><span class="p">)</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="n">get_image_path</span><span class="p">,</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>                      <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">validate_image_size</span><span class="p">],</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>                      <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;图片&#39;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>model中使用clean方法去控制一下比较复杂的模型验证</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># 收支款项</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="k">class</span> <span class="nc">IncomeExpense</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>    <span class="o">....</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>        <span class="n">point</span><span class="p">,</span> <span class="n">is_created</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>            <span class="n">this</span> <span class="o">=</span> <span class="n">IncomeExpense</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>            <span class="c1"># 未支付-&gt;支付</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>            <span class="k">if</span> <span class="n">this</span><span class="o">.</span><span class="n">payment_state</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">payment_state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>                <span class="c1"># 收入 使用余额支付</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">income_expense</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">payment_category</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>                    <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">:</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">({</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>                            <span class="s1">&#39;payment_category&#39;</span><span class="p">:</span> <span class="s1">&#39;账户余额不足 余额:</span><span class="si">{}</span><span class="s1"> 待支付:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">)})</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>            <span class="c1"># 已支付 收入 使用余额支付</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">payment_state</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">income_expense</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">payment_category</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>                <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">:</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>                        <span class="p">{</span><span class="s1">&#39;payment_category&#39;</span><span class="p">:</span> <span class="s1">&#39;账户余额不足 余额:</span><span class="si">{}</span><span class="s1"> 待支付:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">)})</span>
</code></pre></div>
<h3 id="property"><code>property</code></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">比如说现在用户信息中存储了生日的信息</span><span class="err">，</span><span class="n">现在需要根据生日去获取年龄</span><span class="err">，</span><span class="n">一般方法为定义一个get_age的方法</span><span class="err">，</span><span class="n">如下</span><span class="err">：</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>    <span class="k">class</span> <span class="nc">BaseProfile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>        <span class="n">birthdate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>        <span class="c1">#...</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>        <span class="k">def</span> <span class="nf">get_age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>            <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>            <span class="k">return</span> <span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">birthdate</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>            <span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="o">&lt;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">birthdate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">birthdate</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="n">使用</span><span class="err">`</span><span class="n">profile</span><span class="o">.</span><span class="n">get_age</span><span class="p">()</span><span class="err">`</span><span class="n">可以获取到对应的用户年龄信息</span><span class="err">，</span><span class="n">但是profile</span><span class="o">.</span><span class="n">age会更具有可读性也更符合python的编程理念</span><span class="err">，</span><span class="n">这时我们就可以使用</span><span class="err">`</span><span class="nb">property</span><span class="err">`</span><span class="n">装饰器来实现这样的功能</span><span class="p">:</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>    <span class="nd">@property</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>    <span class="k">def</span> <span class="nf">age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="n">这时我们就可以用</span><span class="err">`</span><span class="n">profile</span><span class="o">.</span><span class="n">age</span><span class="err">`</span><span class="n">来获取用户的年龄信息了</span><span class="err">。</span><span class="n">但是</span><span class="err">`</span><span class="n">profile</span><span class="err">`</span><span class="n">有一个缺点就是和类的内部方法一样无法在ORM中使用</span><span class="err">。</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="o">&gt;</span> <span class="n">Django</span> <span class="n">Design</span> <span class="n">Patterns</span> <span class="ow">and</span> <span class="n">Best</span> <span class="n">Practices</span> <span class="n">P45</span>
</code></pre></div>
<h3 id="cached-properties"><code>Cached properties</code></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="err">`</span><span class="n">cached_property</span><span class="err">`</span><span class="n">比对</span><span class="err">`</span><span class="nb">property</span><span class="err">`</span><span class="n">可以缓存计算结果</span><span class="err">，</span><span class="n">适合频繁调用的参数或者计算开销过大的参数</span><span class="err">。</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>    <span class="kn">from</span> <span class="nn">django.utils.functional</span> <span class="kn">import</span> <span class="n">cached_property</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>        <span class="c1">#...</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>        <span class="nd">@cached_property</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>        <span class="k">def</span> <span class="nf">full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastname</span><span class="p">)</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="o">&gt;</span> <span class="n">Django</span> <span class="n">Design</span> <span class="n">Patterns</span> <span class="ow">and</span> <span class="n">Best</span> <span class="n">Practices</span> <span class="n">P45</span>
</code></pre></div>
<h3 id="unique_togethercharnulltrueblanktrue"><code>unique_together</code>其中有Char字段<code>null=True,blank=True</code></h3>
<p><code>unique_together</code>其中有Char字段<code>null=True,blank=True</code>，导致输入null也会报重复错误，此时将<code>CharField</code>替换为<code>CharNullField</code>字段即可。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># issue null=True和unique=True</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="c1"># 同时使用会导致空值被判断为相同</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="k">class</span> <span class="nc">CharNullField</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">):</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;CharField that stores NULL&quot;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    <span class="k">def</span> <span class="nf">get_db_prep_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prepared</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CharNullField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_db_prep_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">prepared</span><span class="p">)</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>            <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
<h2 id="_9">检索相关</h2>
<h3 id="queryset"><code>queryset</code>内操作</h3>
<ul>
<li>
<h3 id="get_object_or_404"><code>get_object_or_404</code></h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>用法： `get_object_or_404(model,filter)`
</code></pre></div>
<ul>
<li>
<h3 id="get_or_create"><code>get_or_create</code></h3>
</li>
</ul>
<p><code>instance, is_created = Model.object.get_or_create(name='my_name')</code></p>
<p><code>instance</code>为新增或者读取到的实例，<code>is_created</code>代表是否是新建的<code>instance</code>。</p>
<ul>
<li>
<h3 id="queryset_1">求querySet某一字段的和</h3>
</li>
</ul>
<p>Annotate adds a field to results:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="o">&gt;&gt;</span> <span class="n">Order</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">total_price</span><span class="o">=</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="o">&gt;</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="o">&gt;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">))</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="p">,</span> <span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="o">&gt;&gt;</span> <span class="n">orders</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">total_price</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;340.00&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Aggregate returns a dict with asked result:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="o">&gt;&gt;</span> <span class="n">Order</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">total_price</span><span class="o">=</span><span class="n">Sum</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">))</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="p">{</span><span class="s1">&#39;total_price&#39;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;1260.00&#39;</span><span class="p">)}</span>
</code></pre></div>
<p>eg：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Sum</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">current_arrange_hours</span> <span class="o">=</span> <span class="n">class_schedule_my_draft</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">Sum</span><span class="p">(</span><span class="s1">&#39;hours&#39;</span><span class="p">))[</span><span class="s1">&#39;hours__sum&#39;</span><span class="p">]</span>
</code></pre></div>
<p>方法返回的是dict对象，键的名称为 求和字段名__sum，获取该dict对象，取值即可得到和。</p>
<ul>
<li>
<h3 id="update"><code>update()</code>方法注意事项</h3>
</li>
</ul>
<p>QuerySet的update()方法会直接生成SQL表达式，不会调用模型的save()方法。</p>
<blockquote>
<p>Be aware that the update() method is converted directly to an SQL statement. It is a bulk operation for direct updates. It doesn’t run anysave() methods on your models, or emit the pre<em>save or post</em>save signals (which are a consequence of calling save()), or honor the auto_now field option. If you want to save every item in a QuerySet and make sure that the save() method is called on each instance, you don’t need any special function to handle that. Just loop over them and call save():</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">my_queryset</span><span class="p">:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><a href="https://docs.djangoproject.com/en/1.8/topics/db/queries/#updating-multiple-objects-at-once">updating-multiple-objects-at-once</a></p>
</blockquote>
<ul>
<li>
<h3 id="annotateaggregate"><code>annotate</code>和<code>aggregat‌e</code>函数</h3>
</li>
</ul>
<p><code>aggregat‌e</code>(聚合)生成的新参数直接加入<code>queryset</code>的属性中，而<code>annotate</code>(备注)是针对<code>queryset</code>中的每个item新增一个属性，其作用对象不同。</p>
<p>需要注意，在<code>queryset</code>使用<code>annotate</code>和<code>aggregate</code>之前，若是使用了<code>filter</code>或者<code>exclude</code>，<code>filter</code>和<code>exclude</code>中的检索条件会被相应的考虑到<code>annotate</code>和<code>aggregate</code>函数之中，若把<code>filter</code>和<code>exclude</code>放在<code>annotate</code>和<code>aggregate</code>函数的后面执行则不会有影响，详见此处。</p>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Count</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">similar_posts</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tag__in</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="n">similar_posts</span> <span class="o">=</span> <span class="n">similar_posts</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">same_tags</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;tag&#39;</span><span class="p">))</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">similar_posts</span><span class="p">:</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">same_tags</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="mi">13</span> <span class="mi">1</span> <span class="p">,</span> <span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="mi">14</span> <span class="mi">2</span> <span class="p">,</span> <span class="p">,</span> <span class="p">]</span><span class="o">&gt;</span>
</code></pre></div>
<p>可见ID为13的message真正有2个标签，但是符合filter中条件的只有1个；ID为14的message真正有3个标签，符合filter中条件的只有2个。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">similar_posts</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># 删除filter后</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="mi">13</span> <span class="mi">2</span> <span class="p">,</span> <span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="mi">14</span> <span class="mi">3</span> <span class="p">,</span> <span class="p">,</span> <span class="p">]</span><span class="o">&gt;</span>
</code></pre></div>
<p>可见删除filter后得到的标签总和才是Message包含的真正标签数量。</p>
<ul>
<li>
<h3 id="values_list"><code>values_list</code>去重</h3>
</li>
</ul>
<p><code>distinct</code>函数必须和<code>order_by</code>配合才生效，<code>order_by</code>在<code>distinct</code>之前之后都可以。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">Craft</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;stage_num&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="n">Craft</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;stage_num&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;stage_num&#39;</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p><a href="https://docs.djangoproject.com/en/2.0/ref/models/querysets/#distinct">Doc model queryset distinct Note</a></p>
</blockquote>
<ul>
<li>
<h3 id="queryset_2">queryset获取外键列表</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># fk_ids = [x.fk.id for x in instance.items.all()]</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">fk_ids</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;fk_id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="n">FK</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">fk_ids</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre></div>
<p>先获取外键ID列表，被注释的方法耗时为0.0020s，未注释的方法耗时为0:00:00，推荐使用未注释的方法，不用遍历列表，直接由数据库操作获取外键ID列表，耗时更低也更为简洁。</p>
<ul>
<li>
<h3 id="manager">自定义Manager</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># 公开文章Manager</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">class</span> <span class="nc">PublicManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PublicManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_public</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="c1"># 文章</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>    <span class="n">is_public</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;公开&#39;</span><span class="p">)</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>    <span class="n">objects</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>    <span class="n">public</span> <span class="o">=</span> <span class="n">PublicManager</span><span class="p">()</span>
</code></pre></div>
<p>获取公开的文章时直接访问<code>Article.public.all()</code>即可，不需要使用<code>Article.objects.filter(is_public=True)</code>,使用起来更方便。</p>
<h3 id="search_fields">如何在 search_fields 中包含外键字段</h3>
<p>当 search_fields 包含外键字段时，此时进行搜索会报错Related Field got invalid lookup: icontains,解决的办法是修改 search_fields 中的外键字段名称。将 search_fields 中的外键字段改为 foreign_key__related_fieldname 这种形式就可以了。 这种用法适用于 ForeignKey 及 ManyToManyField 。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">class</span> <span class="nc">Content</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>    <span class="c1"># 对应商品</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>    <span class="n">goods</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;goods.Goods&#39;</span><span class="p">,</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>                              <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;content_goods&#39;</span><span class="p">,</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>                              <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>                              <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;商品&#39;</span><span class="p">)</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>    <span class="c1"># 商品包含的含量名</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;goods.Category&#39;</span><span class="p">,</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>                                 <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;content_category&#39;</span><span class="p">,</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>                                 <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>                                 <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;含量名&#39;</span><span class="p">)</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>    <span class="c1"># 含量名对应的含量值 max_digits减decimal_places为整数部分支持的最大位数</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.00</span><span class="p">,</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>                                <span class="n">max_digits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>                                <span class="n">decimal_places</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>                                <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;含量值&#39;</span><span class="p">)</span>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>    <span class="c1"># 商品单位</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>    <span class="n">unit</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>                            <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;含量单位&#39;</span><span class="p">)</span>
</code></pre></div>
<p>admin:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="k">class</span> <span class="nc">ContentAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;goods__name&#39;</span><span class="p">,</span> <span class="s1">&#39;category__name&#39;</span><span class="p">,)</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;goods__name&#39;</span><span class="p">,</span> <span class="s1">&#39;category__name&#39;</span><span class="p">,)</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;goods&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">)</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Content</span><span class="p">,</span> <span class="n">ContentAdmin</span><span class="p">)</span>
</code></pre></div>
<h3 id="queryset_3"><code>queryset</code>间操作</h3>
<ul>
<li>
<h3 id="queryset_4"><code>queryset</code>相减</h3>
</li>
</ul>
<p>有父分类的所有含量 减去 该商品已有的含量 作为待选的含量集：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">category_list</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parent__isnull</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="n">goods</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">all</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre></div>
<ul>
<li>
<h3 id="queryset_5"><code>queryset</code>相加</h3>
</li>
</ul>
<p><code>queryset = queryset1 | queryset2</code></p>
<p>注意，<code>|</code>操作会对两个queryset间的重复部分进行去重。</p>
<p>实现原理： 某一天发现了一个奇怪的问题，如下： <img alt="img" src="/img/python/django-queryset-1.jpg" />输入如下： <img alt="img" src="/img/python/django-queryset-2.jpg" /></p>
<p>一个长度为2的<code>queryset</code>和一个长度为0的<code>queryset</code>合并得到了一个长度为3的<code>queryset</code>,检索其<code>query</code>语句才发现这是有可能的，需要对得到的结果再次去重。本质上<code>|</code>操作是对sql语句进行<code>OR</code>,其实现代码如下：</p>
<p><code>models/query.py</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_merge_sanity_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EmptyQuerySet</span><span class="p">):</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>        <span class="k">return</span> <span class="n">other</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">EmptyQuerySet</span><span class="p">):</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>    <span class="n">combined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chain</span><span class="p">()</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>    <span class="n">combined</span><span class="o">.</span><span class="n">_merge_known_related_objects</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>    <span class="n">combined</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">sql</span><span class="o">.</span><span class="n">OR</span><span class="p">)</span>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>    <span class="k">return</span> <span class="n">combined</span>
</code></pre></div>
<h3 id="migrations"><code>migrations</code>文件冲突</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># 合并多个migrations文件至一个</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">squashmigrations</span> <span class="n">app_name</span> <span class="mi">0015</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="c1"># 有conflicting时合并</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span> <span class="err">–</span><span class="n">merge</span>
</code></pre></div>
<h3 id="migrate-fake"><code>migrate --fake</code></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span> <span class="o">--</span><span class="n">fake</span>
</code></pre></div>
<h2 id="url">Url相关</h2>
<ul>
<li>
<h3 id="_10">重定向</h3>
</li>
</ul>
<p>重定向是指将当前的url发送/转译为其它url再进行处理，而不是指返回的url，不能用于页面刷新。</p>
<ul>
<li>
<h3 id="_11">正则</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;author/(?P[0-9]+)/$&#39;</span><span class="p">,</span> <span class="n">AuthorUpdate</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;author-update&#39;</span><span class="p">),</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;author/(?P\d+)/$&#39;</span><span class="p">,</span> <span class="n">AuthorUpdate</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;author-update&#39;</span><span class="p">),</span>
</code></pre></div>
<h2 id="view">View相关</h2>
<ul>
<li>
<h3 id="render">render函数</h3>
</li>
</ul>
<p><code>return render(request,template,data)</code></p>
<ul>
<li>
<h3 id="success_url">动态<code>success_url</code></h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="k">def</span> <span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>    <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;author-detail&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pk&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
</code></pre></div>
<ul>
<li>
<h3 id="_12">基类继承信息时，基类要优先继承，不然不起作用</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="k">class</span> <span class="nc">BaseMixin</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;example&#39;</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">BaseMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="k">class</span> <span class="nc">NewsUpdateView</span><span class="p">(</span><span class="n">BaseMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span> <span class="c1"># 有用 example在页面中可以显示</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="k">class</span> <span class="nc">NewsUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">,</span> <span class="n">BaseMixin</span><span class="p">):</span> <span class="c1"># 没用 example在页面中不可显示</span>
</code></pre></div>
<ul>
<li>
<h3 id="listviewqueryset">ListView中queryset使用陷阱</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">class</span> <span class="nc">NewsAllListView</span><span class="p">(</span><span class="n">ListContextMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>    <span class="n">queryset</span> <span class="o">=</span> <span class="n">News</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">language</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">in_current_lang</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-id&#39;</span><span class="p">)</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;news/list_all.html&#39;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;news_list&#39;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>    <span class="n">paginate_by</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">PAGE_NUM</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>    <span class="c1"># def get_queryset(self):</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>    <span class="c1">#     return News.objects.language(&#39;all&#39;).in_current_lang().order_by(&#39;-id&#39;)</span>
</code></pre></div>
<p>写成员变量queryset</p>
<p>runserver时输出,输出来源于<code>in_current_lang()</code>,该方法用于限制当前语言环境，<code>in_current_lang</code>只会在runserver时被调用一次，之后就算修改了语言环境，queryset成员变量也不会再次根据语言环境进行调整，只有当再次重启服务器时才会调整语言环境，优点是加载快，但是无法实现语言环境的变化。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="p">,</span> <span class="p">,</span> <span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="p">,</span> <span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">System</span> <span class="n">check</span> <span class="n">identified</span> <span class="n">no</span> <span class="n">issues</span> <span class="p">(</span><span class="mi">0</span> <span class="n">silenced</span><span class="p">)</span><span class="o">.</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="n">July</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span> <span class="mi">10</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">29</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="n">Django</span> <span class="n">version</span> <span class="mf">1.11.2</span><span class="p">,</span> <span class="n">using</span> <span class="n">settings</span> <span class="s1">&#39;Portal.settings&#39;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="n">Starting</span> <span class="n">development</span> <span class="n">server</span> <span class="n">at</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">80</span><span class="o">/</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="n">Quit</span> <span class="n">the</span> <span class="n">server</span> <span class="k">with</span> <span class="n">CTRL</span><span class="o">-</span><span class="n">BREAK</span><span class="o">.</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="n">Performing</span> <span class="n">system</span> <span class="n">checks</span><span class="o">...</span>
</code></pre></div>
<p>写成员方法<code>get_queryset</code>时，每次都会根据语言环境去调整queryset来源，缺点是开销比写成员变量大，runserver后输出，每次请求该<code>listview in_current_lang</code>都会被调用：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">System</span> <span class="n">check</span> <span class="n">identified</span> <span class="n">no</span> <span class="n">issues</span> <span class="p">(</span><span class="mi">0</span> <span class="n">silenced</span><span class="p">)</span><span class="o">.</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">July</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span> <span class="mi">10</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">47</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="n">Django</span> <span class="n">version</span> <span class="mf">1.11.2</span><span class="p">,</span> <span class="n">using</span> <span class="n">settings</span> <span class="s1">&#39;Portal.settings&#39;</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="n">Starting</span> <span class="n">development</span> <span class="n">server</span> <span class="n">at</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">80</span><span class="o">/</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="n">Quit</span> <span class="n">the</span> <span class="n">server</span> <span class="k">with</span> <span class="n">CTRL</span><span class="o">-</span><span class="n">BREAK</span><span class="o">.</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="mi">2017</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">18</span> <span class="mi">10</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">52</span><span class="p">,</span><span class="mi">375</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span><span class="o">-</span> <span class="s2">&quot;GET /manage/ HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">6224</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="mi">2017</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">18</span> <span class="mi">10</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">52</span><span class="p">,</span><span class="mi">442</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span><span class="o">-</span> <span class="s2">&quot;GET /manage/home/ HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">1412</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="mi">2017</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">18</span> <span class="mi">10</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">52</span><span class="p">,</span><span class="mi">788</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span><span class="o">-</span> <span class="s2">&quot;GET /static/images/favicon.ico HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">1099</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="p">,</span> <span class="p">,</span> <span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="p">,</span> <span class="p">]</span><span class="o">&gt;</span>
</code></pre></div>
<h2 id="form">Form相关</h2>
<ul>
<li>
<h3 id="_13">使用预设的错误</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="k">class</span> <span class="nc">LoginForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>    <span class="n">error_messages</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>        <span class="s1">&#39;login_error&#39;</span><span class="p">:</span> <span class="s2">&quot;账户名或密码输入错误&quot;</span><span class="p">,</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>    <span class="p">}</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span><span class="p">[</span><span class="s2">&quot;login_error&quot;</span><span class="p">])</span>
</code></pre></div>
<ul>
<li>
<h3 id="_14">动态添加错误</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;账户名或密码输入错误&quot;</span><span class="p">)</span> <span class="c1"># username为错误发生的字段</span>
</code></pre></div>
<h2 id="template">Template相关</h2>
<ul>
<li>
<h3 id="html">渲染变量至html</h3>
</li>
</ul>
<p>在界面中将某个变量渲染成为html有两种方法：</p>
<ul>
<li><code>{% autoescape off %} {{content}} {% endautoescape %}</code></li>
<li>
<p><code>{{content|safe}}</code></p>
</li>
<li>
<h3 id="templet">templet常用过滤器</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="p">{{</span> <span class="n">solution</span><span class="o">.</span><span class="n">title</span><span class="o">|</span><span class="n">truncatechars</span><span class="p">:</span><span class="mi">20</span> <span class="p">}}</span> <span class="c1"># 20个字符后显示...</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="p">{{</span> <span class="n">solution</span><span class="o">.</span><span class="n">create_time</span><span class="o">|</span><span class="n">date</span><span class="p">:</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span> <span class="p">}}</span> <span class="c1"># datatime格式</span>
</code></pre></div>
<ul>
<li>
<h3 id="_15">检测用户是否有某项权限</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">perms</span><span class="o">.</span><span class="n">app_label</span><span class="o">.</span><span class="n">can_do_something</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div>
<p><code>perms</code>是一个<code>django.contrib.auth.context_processors.PermWrapper</code>对象，文档<a href="https://docs.djangoproject.com/el/1.11/topics/auth/default/#permissions">见此</a>。 若使用<code>get_template</code>来渲染页面时需要<code>perms</code>对象：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">get_template</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="kn">from</span> <span class="nn">django.contrib.auth.context_processors</span> <span class="kn">import</span> <span class="n">PermWrapper</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">article_list</span><span class="p">:</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>    <span class="n">html</span> <span class="o">+=</span> <span class="n">get_template</span><span class="p">(</span><span class="s1">&#39;article/article_item.html&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">({</span><span class="s1">&#39;article&#39;</span><span class="p">:</span> <span class="n">article</span><span class="p">,</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>                                                              <span class="s1">&#39;perms&#39;</span><span class="p">:</span> <span class="n">PermWrapper</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)})</span>
</code></pre></div>
<ul>
<li>
<h3 id="booleanjs">传递boolean至js</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">context</span><span class="p">[</span><span class="s1">&#39;is_html&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="p">{{</span> <span class="n">is_html</span><span class="o">|</span><span class="n">yesno</span><span class="p">:</span><span class="s2">&quot;true,false&quot;</span> <span class="p">}}</span>
</code></pre></div>
<ul>
<li>
<h3 id="listjs">传递list至js</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">var</span> <span class="n">tags</span> <span class="o">=</span> <span class="p">{{</span> <span class="n">tags</span><span class="o">|</span><span class="n">safe</span> <span class="p">}};</span>
</code></pre></div>
<ul>
<li>
<h3 id="_16">绝对路径生成</h3>
</li>
<li>
<p>生成本页的绝对路径 <code>{{ request.build_absolute_uri }}</code></p>
</li>
<li>生成有<code>url name</code>的<code>url</code>的绝对路径 <code>{% absurl 'web_news_detail' news.id %}</code></li>
<li>生成静态文件对应的绝对路径 <code>{{ news.cover.url|absolute_media_url:request }}</code></li>
</ul>
<p>使用的模板标签文件 在模板中使用时务必使用<code>{% load absolute_url %}</code>加载标签 <code>absolute_url.py</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Library</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="kn">from</span> <span class="nn">django.template.defaulttags</span> <span class="kn">import</span> <span class="n">URLNode</span><span class="p">,</span> <span class="n">url</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="n">register</span> <span class="o">=</span> <span class="n">Library</span><span class="p">()</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="k">class</span> <span class="nc">AbsoluteURL</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>    <span class="k">pass</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="k">class</span> <span class="nc">AbsoluteURLNode</span><span class="p">(</span><span class="n">URLNode</span><span class="p">):</span>
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>    <span class="sd">&quot;&quot;&quot;生成绝对路径的url标签&quot;&quot;&quot;</span>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>        <span class="n">asvar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">asvar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asvar</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a>        <span class="n">path</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AbsoluteURLNode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a>        <span class="n">request</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span>
<a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a>        <span class="n">abs_url</span> <span class="o">=</span> <span class="n">AbsoluteURL</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">build_absolute_uri</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a>        <span class="c1"># 保持request parameters不丢失</span>
<a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">doseq</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a>        <span class="k">if</span> <span class="n">parameters</span><span class="p">:</span>
<a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a>            <span class="n">abs_url</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">?</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">abs_url</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a>
<a id="__codelineno-53-25" name="__codelineno-53-25" href="#__codelineno-53-25"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">asvar</span><span class="p">:</span>
<a id="__codelineno-53-26" name="__codelineno-53-26" href="#__codelineno-53-26"></a>            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">abs_url</span><span class="p">)</span>
<a id="__codelineno-53-27" name="__codelineno-53-27" href="#__codelineno-53-27"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-53-28" name="__codelineno-53-28" href="#__codelineno-53-28"></a>            <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
<a id="__codelineno-53-29" name="__codelineno-53-29" href="#__codelineno-53-29"></a>                <span class="n">abs_url</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="s1">&#39;active&#39;</span>
<a id="__codelineno-53-30" name="__codelineno-53-30" href="#__codelineno-53-30"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-53-31" name="__codelineno-53-31" href="#__codelineno-53-31"></a>                <span class="n">abs_url</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a id="__codelineno-53-32" name="__codelineno-53-32" href="#__codelineno-53-32"></a>            <span class="n">context</span><span class="p">[</span><span class="n">asvar</span><span class="p">]</span> <span class="o">=</span> <span class="n">abs_url</span>
<a id="__codelineno-53-33" name="__codelineno-53-33" href="#__codelineno-53-33"></a>            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
<a id="__codelineno-53-34" name="__codelineno-53-34" href="#__codelineno-53-34"></a>
<a id="__codelineno-53-35" name="__codelineno-53-35" href="#__codelineno-53-35"></a>
<a id="__codelineno-53-36" name="__codelineno-53-36" href="#__codelineno-53-36"></a><span class="nd">@register</span><span class="o">.</span><span class="n">tag</span>
<a id="__codelineno-53-37" name="__codelineno-53-37" href="#__codelineno-53-37"></a><span class="k">def</span> <span class="nf">absurl</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
<a id="__codelineno-53-38" name="__codelineno-53-38" href="#__codelineno-53-38"></a>    <span class="n">node</span> <span class="o">=</span> <span class="n">url</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
<a id="__codelineno-53-39" name="__codelineno-53-39" href="#__codelineno-53-39"></a>    <span class="k">return</span> <span class="n">AbsoluteURLNode</span><span class="p">(</span>
<a id="__codelineno-53-40" name="__codelineno-53-40" href="#__codelineno-53-40"></a>        <span class="n">view_name</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">view_name</span><span class="p">,</span>
<a id="__codelineno-53-41" name="__codelineno-53-41" href="#__codelineno-53-41"></a>        <span class="n">args</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-53-42" name="__codelineno-53-42" href="#__codelineno-53-42"></a>        <span class="n">kwargs</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-53-43" name="__codelineno-53-43" href="#__codelineno-53-43"></a>        <span class="n">asvar</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">asvar</span>
<a id="__codelineno-53-44" name="__codelineno-53-44" href="#__codelineno-53-44"></a>    <span class="p">)</span>
<a id="__codelineno-53-45" name="__codelineno-53-45" href="#__codelineno-53-45"></a>
<a id="__codelineno-53-46" name="__codelineno-53-46" href="#__codelineno-53-46"></a>
<a id="__codelineno-53-47" name="__codelineno-53-47" href="#__codelineno-53-47"></a><span class="nd">@register</span><span class="o">.</span><span class="n">filter</span>
<a id="__codelineno-53-48" name="__codelineno-53-48" href="#__codelineno-53-48"></a><span class="k">def</span> <span class="nf">absolute_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<a id="__codelineno-53-49" name="__codelineno-53-49" href="#__codelineno-53-49"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-53-50" name="__codelineno-53-50" href="#__codelineno-53-50"></a><span class="sd">    Usage: {{ url|absolute_url:request }}</span>
<a id="__codelineno-53-51" name="__codelineno-53-51" href="#__codelineno-53-51"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-53-52" name="__codelineno-53-52" href="#__codelineno-53-52"></a>    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">build_absolute_uri</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>
<h3 id="django-filter">Django-filter</h3>
</li>
</ul>
<p>filter.qs为过滤后的queryset； filter.data为当前过滤取得的数据，如filter.data.category既为当前取得的类型ID。</p>
<ul>
<li>
<h3 id="tags">自定义Tags</h3>
</li>
</ul>
<p>示例<code>Tags</code>的作用是高亮当前<code>Navbar</code>选中的选项。</p>
<p>(1) 新建<code>templatetags</code>文件夹，放入空的<code>__init__.py</code>文件。</p>
<p>(2) <code>app/templatetags/nav.py</code>：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">resolve</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Library</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="n">register</span> <span class="o">=</span> <span class="n">Library</span><span class="p">()</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="nd">@register</span><span class="o">.</span><span class="n">simple_tag</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="k">def</span> <span class="nf">active_nav</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>    <span class="n">url_name</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">url_name</span>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a>    <span class="k">if</span> <span class="n">url_name</span> <span class="o">==</span> <span class="n">url</span><span class="p">:</span>
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a>        <span class="k">return</span> <span class="s2">&quot;active&quot;</span>
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a>    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div>
<p>(3) 用法 <code>{% active_nav request 'pattern_name' %}</code></p>
<h3 id="_17">分页</h3>
<p>使用paginate_by设置每页可显示的个数:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1"># Goods列表</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="k">class</span> <span class="nc">GoodsListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Goods</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;goodsList&#39;</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>    <span class="n">paginate_by</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;goods/list.html&#39;</span>
</code></pre></div>
<p>使用page_obj变量来显示分页 goods/list.html:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>{ % block content %}
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="err">&lt;</span> !--分页 --&gt;
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>{ % if page_obj %}
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>{ % include
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>&quot;include/pagination.html&quot; %}
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>{ % endif %}
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>{ % endblock %}
</code></pre></div>
<p>paginate.html:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pagination&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>    {% if  page_obj.has_previous %}
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page={{page_obj.previous_page_number}}&quot;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page={{page_obj.previous_page_number}}&quot;</span><span class="p">&gt;</span>{{page_obj.previous_page_number}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>    {% else %}
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>         <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>    {% endif %}
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>    <span class="p">&lt;</span><span class="nt">li</span>  <span class="na">class</span><span class="o">=</span><span class="s">&quot;active&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page={{page_obj.number}}&quot;</span><span class="p">&gt;</span>{{page_obj.number}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>    {% if  page_obj.has_next%}
<a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page={{page_obj.next_page_number}}&quot;</span><span class="p">&gt;</span>{{page_obj.next_page_number}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a>        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a>        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page={{page_obj.next_page_number}}&quot;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a>        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a>    {% else %}
<a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a>        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a>        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-57-22" name="__codelineno-57-22" href="#__codelineno-57-22"></a>    {% endif %}
<a id="__codelineno-57-23" name="__codelineno-57-23" href="#__codelineno-57-23"></a><span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>page_obj.has_previous 是否有上一页</li>
<li>page_obj.has_next 是否有下一页</li>
<li>page_obj.previous_page_number 上一页页码</li>
<li>page_obj.next_page_number 下一页页码</li>
<li>page_obj.number 当前页码</li>
<li>paginator.num_pages 总页码数</li>
</ul>
<h2 id="admin">Admin相关</h2>
<ul>
<li>
<h3 id="list">方法结果显示在list中</h3>
</li>
<li>
<p>写在<code>admins.py</code>中：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1"># 试听</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="k">class</span> <span class="nc">AuditionAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;pre_student&#39;</span><span class="p">,</span> <span class="s1">&#39;follower&#39;</span><span class="p">,</span> <span class="s1">&#39;course&#39;</span><span class="p">,</span> <span class="s1">&#39;teacher&#39;</span><span class="p">,</span> <span class="s1">&#39;class_room&#39;</span><span class="p">,</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>                    <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;feed_back_staff&#39;</span><span class="p">,</span> <span class="s1">&#39;feed_back_time&#39;</span><span class="p">]</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="p">)</span>　<span class="err">＃</span> <span class="n">横向过滤器</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>    <span class="k">def</span> <span class="nf">course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span> 
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>        <span class="c1">#list_display 外键</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">class_schedule</span><span class="o">.</span><span class="n">course</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>    <span class="n">course</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;课程&#39;</span>
</code></pre></div>
</li>
<li>
<p>写在<code>models.py</code>中：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>    <span class="o">...</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>    <span class="c1"># 获取全名</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>    <span class="k">def</span> <span class="nf">get_full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>    <span class="n">get_full_name</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;全名&#39;</span>
<a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a>
<a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="k">class</span> <span class="nc">MyUserAdmin</span><span class="p">(</span><span class="n">UserAdmin</span><span class="p">):</span>
<a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a>    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;get_full_name&#39;</span><span class="p">,</span> <span class="s1">&#39;tel&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">]</span>
</code></pre></div>
</li>
<li>
<h3 id="_18">设置字段只读</h3>
</li>
</ul>
<p>可见但不接修改</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">readonly_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;word_count&#39;</span><span class="p">,)</span>
</code></pre></div>
<ul>
<li>
<h3 id="admin_1">设置字段不出现在admin中</h3>
</li>
</ul>
<p>则在</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>model
</code></pre></div>
<p>字段中设置</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>editable=False
</code></pre></div>
<p>即可</p>
<ul>
<li>
<h3 id="superuser">修改SuperUser密码</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>python manage.py changepassword 修改admin密码
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>python manage.py changepassword username 指定用户修改admin密码
</code></pre></div>
<ul>
<li>
<h3 id="admintitle">设置站点admin显示title</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>admin.site.site_title = &#39;测试&#39;
</code></pre></div>
<ul>
<li>
<h3 id="appverbose_name">设置app的<code>verbose_name</code></h3>
</li>
</ul>
<p><code>apps.py</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="k">class</span> <span class="nc">UserConfig</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">):</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;用户&#39;</span>
</code></pre></div>
<p><code>__init__.py</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="n">default_app_config</span> <span class="o">=</span> <span class="s1">&#39;user.apps.UserConfig&#39;</span>
</code></pre></div>
<ul>
<li>
<h3 id="modelverbose_name">设置model的verbose_name</h3>
</li>
</ul>
<p><code>models.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>    <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;用户&#39;</span><span class="p">)</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>    <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;用户&#39;</span><span class="p">)</span> <span class="c1"># 复数时显示的值</span>
</code></pre></div>
<ul>
<li>
<h3 id="_19">设置列表可编辑字段</h3>
</li>
</ul>
<p>设置</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="n">list_editable</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;is_locked&#39;</span><span class="p">)</span>
</code></pre></div>
<p>即可一次编辑列表上多行数据对应的某些字段，但是要求这些字段都在</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="n">list_display</span>
</code></pre></div>
<p>中。</p>
<h2 id="utils">Utils相关</h2>
<ul>
<li>
<h3 id="_20">字符拼接</h3>
</li>
<li>
<p>'数字：%d 字符串 %s'%(instance.pk,instance.name)</p>
</li>
<li>单个变量时后面可不用括号，如：'字符串:%s'%instance.name</li>
<li>'{}{}'.format(str1, str2) 优于使用%</li>
<li>
<p>'{one}{two}'.format(one=str1, two=str2)</p>
</li>
<li>
<h3 id="_21">页面间消息传递</h3>
</li>
</ul>
<p>Django的message框架可以用来传递页面之间的消息</p>
<ul>
<li>
<h3 id="str">判断str是否为数字</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">&quot;03523&quot;</span> <span class="c1"># 判断字符串是否是数字</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="kc">True</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="s2">&quot;963spam&quot;</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="kc">False</span>
</code></pre></div>
<p>封装后：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="k">def</span> <span class="nf">isdigit</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="sd">    :param string:</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="sd">    :return: 该字符是否是数字</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">string</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
</code></pre></div>
<ul>
<li>
<h3 id="model_1">由数据库表名称获取对应的model</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">apps</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="n">model</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_models</span><span class="p">()</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span> <span class="o">==</span> <span class="s1">&#39;family_smstemplate&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>
<h3 id="_22">字符串连续定义</h3>
</li>
</ul>
<p>避免写多行，更简洁。</p>
<p><code>subject, from_email, to = 'hello', settings.EMAIL_HOST_USER, '614457662@qq.com'</code></p>
<ul>
<li>
<h3 id="python">Python类型判断</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>    <span class="k">pass</span>  
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">Foo</span><span class="p">):</span>  
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>    <span class="k">pass</span>  
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="nb">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">Foo</span><span class="p">())</span> <span class="o">==</span> <span class="n">Foo</span>  <span class="kc">True</span>
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="nb">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">Bar</span><span class="p">())</span> <span class="o">==</span> <span class="n">Foo</span>  <span class="kc">False</span>
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="nb">print</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Bar</span><span class="p">(),</span><span class="n">Foo</span><span class="p">)</span> <span class="kc">True</span>
</code></pre></div>
<p><code>type</code>不会认为子类是一种父类类型，<code>isinstance</code>会认为子类是一种父类类型。</p>
<h2 id="_23">信号</h2>
<ul>
<li>
<h3 id="request_finished">request_finished</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="kn">from</span> <span class="nn">django.core.signals</span> <span class="kn">import</span> <span class="n">request_finished</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="kn">from</span> <span class="nn">django.dispatch</span> <span class="kn">import</span> <span class="n">receiver</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="nd">@receiver</span><span class="p">(</span><span class="n">request_finished</span><span class="p">)</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="k">def</span> <span class="nf">my_callback</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request finished!&quot;</span><span class="p">)</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="kn">from</span> <span class="nn">django.dispatch</span> <span class="kn">import</span> <span class="n">Signal</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="n">request_started</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;environ&quot;</span><span class="p">])</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="n">request_finished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="n">got_request_exception</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">])</span>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="n">setting_changed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;setting&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;enter&quot;</span><span class="p">])</span>
</code></pre></div>
<ul>
<li>
<h3 id="_24">自定义信号</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="kn">from</span> <span class="nn">django.dispatch</span> <span class="kn">import</span> <span class="n">receiver</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="n">post_viewed</span> <span class="o">=</span> <span class="n">django</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">])</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="nd">@receiver</span><span class="p">(</span><span class="n">post_viewed</span><span class="p">)</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="k">def</span> <span class="nf">handle_post_viewed</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------&#39;</span><span class="p">)</span>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>
<a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a>
<a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="c1"># 用户</span>
<a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="k">class</span> <span class="nc">UserViewSet</span><span class="p">(</span><span class="n">ModelViewSet</span><span class="p">):</span>
<a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a>    <span class="n">queryset</span> <span class="o">=</span> <span class="n">UserMessage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a>    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserSerializer</span>
<a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a>
<a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a>    <span class="nd">@list_route</span><span class="p">(</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a>    <span class="k">def</span> <span class="nf">sender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span><span class="c1"># 发出信号</span>
<a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a>        <span class="n">post_viewed</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<a id="__codelineno-75-18" name="__codelineno-75-18" href="#__codelineno-75-18"></a>        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;sender&#39;</span><span class="p">)</span>
<a id="__codelineno-75-19" name="__codelineno-75-19" href="#__codelineno-75-19"></a>
<a id="__codelineno-75-20" name="__codelineno-75-20" href="#__codelineno-75-20"></a>    <span class="nd">@list_route</span><span class="p">(</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span><span class="c1"># 不发出信号</span>
<a id="__codelineno-75-21" name="__codelineno-75-21" href="#__codelineno-75-21"></a>    <span class="k">def</span> <span class="nf">receiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<a id="__codelineno-75-22" name="__codelineno-75-22" href="#__codelineno-75-22"></a>        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>
<h3 id="pre_save">pre_save</h3>
</li>
</ul>
<p>it's used before the transaction saves.</p>
<ul>
<li>
<h3 id="post_save">post_save</h3>
</li>
</ul>
<p>it's used after the transaction saves.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="kn">from</span> <span class="nn">django.dispatch</span> <span class="kn">import</span> <span class="n">receiver</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="kn">from</span> <span class="nn">django.db.models.signals</span> <span class="kn">import</span> <span class="n">post_save</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="nd">@receiver</span><span class="p">(</span><span class="n">post_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">)</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="k">def</span> <span class="nf">user_create</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>    <span class="k">if</span> <span class="n">created</span><span class="p">:</span>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>        <span class="n">member</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>        <span class="n">family</span> <span class="o">=</span> <span class="n">Family</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a>        <span class="n">family</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>
<h3 id="_25">信号不触发问题</h3>
</li>
</ul>
<p>新建<code>signals.py</code>文件写信号相关的代码时，需要在<code>apps.py</code>中新增<code>ready</code>函数</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="k">class</span> <span class="nc">UserConfig</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">):</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;用户&#39;</span>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>    <span class="k">def</span> <span class="nf">ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a>        <span class="kn">import</span> <span class="nn">user.signals</span>
</code></pre></div>
<p>不然会导致<code>signals.py</code>中的代码无法生效。而且必须要用<code>import user.signals</code>导入而不可用<code>from .signals import *</code>导入,不然会提示<code>SyntaxError: import * only allowed at module level</code>错误。</p>
<h2 id="_26">测试</h2>
<ul>
<li>
<h3 id="_27">测试驱动开发</h3>
</li>
</ul>
<p>既在写功能代码前，优先写测试代码，虽然与直觉相悖，但是这与一般人做事的顺序相同，先发现问题，再写代码去解决这个问题，只是<code>测试驱动开发</code>把这个过程形式化了。</p>
<blockquote>
<p><a href="https://docs.djangoproject.com/en/1.11/intro/tutorial05/#basic-testing-strategies">basic-testing-strategies</a></p>
</blockquote>
<ul>
<li>
<h3 id="_28">测试函数</h3>
</li>
</ul>
<p>函数必须以小写的test开头，各个测试之间要独立，调用的顺序为函数名的字母顺序，每个测试函数测试完成后数据库将自动回滚至初始状态。</p>
<ul>
<li>
<h3 id="pycharm">Pycharm中运行测试的注意事项</h3>
</li>
</ul>
<p>鼠标指针位于测试案例的某个函数的作用域内将只执行这个函数，位于测试案例的作用域内将执行整个测试案例。</p>
<ul>
<li>
<h3 id="_29">设置断点</h3>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>import pdb
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>pdb.set_trace()
</code></pre></div>
<p>之后在控制台将看到<code>（Pdb）:</code>，可以输入Python语句进行交互检查。</p>
<h2 id="_30">第三方工具及作用简介</h2>
<ul>
<li>
<h3 id="django-celery">django-celery</h3>
</li>
</ul>
<p>异步发送邮件、处理任务使用库</p>
<h2 id="_31">其他</h2>
<ul>
<li>
<h3 id="_32">定义类内部方法</h3>
</li>
</ul>
<p>双下划线（double undersocres）用户定义类的内部属性 用于定义只可在类的内部使用的参数和方法</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a> # __保证该函数不可被外部调用
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>def __send_sms(self, tel, content):
</code></pre></div>
<ul>
<li>
<h3 id="_33">三目运算精简代码</h3>
</li>
</ul>
<p><code>state = True if day == date else False</code></p>
<p>等价于：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="n">date</span><span class="p">:</span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>    <span class="n">state</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>    <span class="n">state</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>
<ul>
<li>
<h3 id="requestdatadictquerydict">request.data类型是Dict不是QueryDict</h3>
</li>
</ul>
<p>使用requests库直接向Django发起请求时，服务器接收到的request.data类型是Dict不是QueryDict，会导致request.data的getlist方法无法使用。解决方法：</p>
<ol>
<li>
<p>直接判断类型 dict类型时使用dict['name']，QueryDict类型时使用querydict.getlist('name')， PS:dict['name']等价于querydict.getlist('name')</p>
</li>
<li>
<p>进行类型转换 Django1.11如下：</p>
<p>from django.http import QueryDict from django.utils.datastructures import MultiValueDict</p>
<p>data = QueryDict('', mutable=True) data.update(MultiValueDict(request.data)) print(data.getlist('id')) def dict<em>to</em>query_dict(<em>dict): """ requests库请求时request.data为dict 需要转换为query</em>dict才能使用getlist方法 :param <em>dict: dict :return: query*dict """ query*dict = QueryDict('', mutable=True) query</em>dict.update(MultiValueDict(<em>dict)) return query</em>dict</p>
<p>data = dict<em>to</em>query_dict(request.data) if isinstance(request.data, dict) else request.data items = data.getlist('items')</p>
</li>
</ol>
<p><code>MultiValueDict</code>介绍如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="k">class</span> <span class="nc">MultiValueDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="sd">    A subclass of dictionary customized to handle multiple values for the</span>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="sd">    same key.</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="sd">    &gt;&gt;&gt; d = MultiValueDict({&#39;name&#39;: [&#39;Adrian&#39;, &#39;Simon&#39;], &#39;position&#39;: [&#39;Developer&#39;]})</span>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="sd">    &gt;&gt;&gt; d[&#39;name&#39;]</span>
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="sd">    &#39;Simon&#39;</span>
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="sd">    &gt;&gt;&gt; d.getlist(&#39;name&#39;)</span>
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a><span class="sd">    [&#39;Adrian&#39;, &#39;Simon&#39;]</span>
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="sd">    &gt;&gt;&gt; d.getlist(&#39;doesnotexist&#39;)</span>
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a><span class="sd">    []</span>
<a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a><span class="sd">    &gt;&gt;&gt; d.getlist(&#39;doesnotexist&#39;, [&#39;Adrian&#39;, &#39;Simon&#39;])</span>
<a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a><span class="sd">    [&#39;Adrian&#39;, &#39;Simon&#39;]</span>
<a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a><span class="sd">    &gt;&gt;&gt; d.get(&#39;lastname&#39;, &#39;nonexistent&#39;)</span>
<a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a><span class="sd">    &#39;nonexistent&#39;</span>
<a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a><span class="sd">    &gt;&gt;&gt; d.setlist(&#39;lastname&#39;, [&#39;Holovaty&#39;, &#39;Willison&#39;])</span>
<a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a>
<a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a><span class="sd">    This class exists to solve the irritating problem raised by cgi.parse_qs,</span>
<a id="__codelineno-81-20" name="__codelineno-81-20" href="#__codelineno-81-20"></a><span class="sd">    which returns a list for every key, even though most Web forms submit</span>
<a id="__codelineno-81-21" name="__codelineno-81-21" href="#__codelineno-81-21"></a><span class="sd">    single name-value pairs.</span>
<a id="__codelineno-81-22" name="__codelineno-81-22" href="#__codelineno-81-22"></a><span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<p>requets发起请求：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="kn">import</span> <span class="nn">requests</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;ss&#39;</span><span class="p">:</span> <span class="s1">&#39;sss&#39;</span><span class="p">}</span>
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a>
<a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://192.168.1.108/purchase_courses/test/&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a>                  <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Token 75xxxxxxxxxxxxxxxxxxxxxfb4&#39;</span><span class="p">})</span>
<a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a>
<a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>
<h3 id="sql">原生sql防注入</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="n">c</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="n">max_price</span><span class="o">=</span><span class="mi">5</span>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT spam, eggs, sausage FROM breakfast</span>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="s2">          WHERE price &lt; </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">max_price</span><span class="p">,))</span>
</code></pre></div>
<p>而不是</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT spam, eggs, sausage FROM breakfast</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="s2">          WHERE price &lt; </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">max_price</span><span class="p">,))</span>
</code></pre></div>
<blockquote>
<p><a href="https://stackoverflow.com/questions/7929364/python-best-practice-and-securest-to-connect-to-mysql-and-execute-queries">Python best practice and securest to connect to MySQL and execute queries</a></p>
</blockquote>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            回到页面顶部
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="页脚">
      
        
        <a href="../../fastapi/Flask-Django-FastApi-SpringBoot-Go-performance/" class="md-footer__link md-footer__link--prev" aria-label="上一页: Flask、Django、FastApi、SpringBoot、Go性能比较" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              Flask、Django、FastApi、SpringBoot、Go性能比较
            </div>
          </div>
        </a>
      
      
        
        <a href="../django-summernote/" class="md-footer__link md-footer__link--next" aria-label="下一页: Django-summernote富文本" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              Django-summernote富文本
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2017 - 2022 <a href="https://www.yinkh.top/">YinKH</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://stackoverflow.com/users/6786283/ykh" target="_blank" rel="noopener" title="stackoverflow.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/yinkh" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="mailto:yin-kh@qq.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M0 128c0-35.35 28.65-64 64-64h384c35.3 0 64 28.65 64 64v256c0 35.3-28.7 64-64 64H64c-35.35 0-64-28.7-64-64V128zm48 0v22.1l172.5 141.6c20.6 17 50.4 17 71 0L464 150.1v-23c0-7.9-7.2-16-16-16H64c-8.84 0-16 8.1-16 16v.9zm0 84.2V384c0 8.8 7.16 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.6 31.5-132.9 0L48 212.2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.header", "navigation.top", "navigation.tracking", "navigation.sections", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>